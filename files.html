<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Pizarrones Plata - Cotización</title>
    <link rel="shortcut icon" type="image/x-icon" href="img/Icono.ico">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/FontAwesome 5.8/css/all.min.css">
</head>
<body>
    <span id="alert" class="alert"></span>

    <header>
        <img src="img/Logo.png" alt="Logo Pizarrones Plata">
    </header>

    <main>
        <aside>
            <nav>
                <ul>
                    <li>
                        <a href="index.html" id="btnHome"><i class="fas fa-home"></i></a>
                    </li>

                    <li>
                        <a href="files.html" id="btnFiles"><i class="fas fa-folder-open"></i></a>
                    </li>
                </ul>
            </nav>
        </aside>

        <article>
            <section class="archivosContent">
                <h1 id="titulo">Cotizaciones</h1>

                <form action="" method="POST" enctype="multipart/form-data" id="filesForm">
                    <img src="IMG/ChooseFile.png" alt="Elegir" class="elegir">
                    <input type="file" name="archivo[]" multiple id="inputFile">
                    <input type="submit" id="btnSubir" value="Subir"></input>
                </form>
                
                <table>
                    <thead>
                        <tr>
                            <th>Nombre del archivo</th>
                            <th>Fecha de creación</th>
                            <th>Herramientas</th>
                        </tr>
                    </thead>
                
                    <tbody id="fileList"></tbody>
                </table>
            </section>
        </article>
    </main>
    
    <script src="js/jquery-3.4.1.min.js"></script>
    <script>
        $(document).ready(function () {
            leerArchivos();
        });

        $("#filesForm").submit(function(e) {
            e.preventDefault();
            subiendoArchivos();
        });

        $(document).on("click", "#eliminar", function() {
            let nombre_archivo = $(this).attr("data-nombre_eliminar");

            if (confirm("¿Estás seguro de eliminar el archivo?")) {
                eliminarArchivo(nombre_archivo);
                leerArchivos();
            }
        });

        //Subiendo archivos
        function subiendoArchivos() {
            var form = new FormData($('#filesForm')[0]);

            $.ajax({
                url: "php/uploadFiles.php",
                type: "POST",
                data: form,
                processData: false,
                contentType: false,
                success: function (data) {
                    $("#fileList").html("");
                    leerArchivos();
                    $("#inputFile").val("");
                }
            })
        }

        //Eliminando Archivos
        function eliminarArchivo(nombre_archivo) {
            $.ajax({
                url: "php/deleteFile.php",
                type: "POST",
                data: {"nombre_archivo" : nombre_archivo},
                dataType: 'text',
                success: function(data) {
                    if (data == "true") {
                        $("#alert").removeClass("alert-false").addClass("alert-true");
                        $("#alert").text("El archivo se eliminó correctamente del servidor.");
                    } else {
                        $("#alert").removeClass("alert-true").addClass("alert-false");
                        $("#alert").text("Hubo un error al eliminar el archivo del servidor, pongase en contacto con el administrador del sistema.");
                    }
                    
                    $("#alert").css({ 'right': '0' });

                    setTimeout(() => {$("#alert").css({ 'right': '-150%' });}, 2000);
                }
            })
        }

        //Listando Archivos
        function leerArchivos() {
            $.ajax({
                url: "php/getFiles.php",
                type: "POST",
                processData: false,
                contentType: false,
                success: function(data) {
                    $("#fileList").html(data);
                }
            })
        }
    </script>
</body>
</html>